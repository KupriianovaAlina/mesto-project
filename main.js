(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p:""};e.d({},{Ml:()=>G,HG:()=>F});var t=/^[a-zа-яё\s-]+$/gi,n={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},o=document.querySelector(".profile__edit-button"),c=document.querySelector(".profile__add-button"),r=document.querySelector("#popup-edit-profile"),a=r.querySelector(".popup__button"),u=document.querySelector("#popup-add-card"),l=u.querySelector(".popup__button"),i=document.querySelector("#close-button-profile"),s=document.querySelector("#close-button-card"),d=document.querySelector("#close-button-delete"),p=document.querySelector("#close-button-img"),f=document.querySelector(".profile__name"),m=document.querySelector(".profile__occupation"),v=document.querySelector('input[name="name"]'),h=document.querySelector('input[name="occupation"]'),_=document.querySelector('form[name="info"]'),y=document.querySelector('form[name="card"]'),S=document.querySelector("#element").content,b=document.querySelector(".elements"),q=document.querySelector('input[name="card"]'),E=document.querySelector('input[name="link"]'),C=document.querySelector("#photo-window"),L=C.querySelector(".photo-window__title"),k=C.querySelector(".photo-window__img"),g=document.querySelector(".profile__avatar-img"),x=document.querySelector("#popup-delete-card"),w=(document.querySelector("#submit-button-delete"),document.querySelector(".profile__avatar")),A=document.querySelector("#popup-chage-photo"),U=A.querySelector(".popup__input"),B=document.querySelector("#close-button-profile-img"),T=document.querySelector("#button-change-photo");function j(e){"Escape"===e.key&&P(document.querySelector(".popup_opened"))}function O(e){e.classList.add("popup_opened"),document.addEventListener("keydown",j)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",j)}function N(e){return/\.(jpg|jpeg|png|webp|avif|gif|svg)$/.test(e)}const D=e.p+"bf071aaeb50fce784f9c.png";var G,H={baseUrl:"https://nomoreparties.co/v1/plus-cohort-16/",headers:{authorization:"90c506b7-d892-431a-a44c-210a32f77305","Content-Type":"application/json"}};function J(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function z(e){var t=S.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__like-button"),o=t.querySelector(".element__like-number"),c=t.querySelector(".element__delete-button"),r=t.querySelector(".element__photo"),a=t.querySelector(".element__place");return a.textContent=e.name,r.alt=e.name,N(e.link)?r.src=e.link:r.src=D,e.likes.some((function(e){return e._id==G}))&&n.classList.add("element__like-button_active"),n.addEventListener("click",(function(){var t;n.classList.contains("element__like-button_active")?(t=e._id,fetch("".concat(H.baseUrl,"cards/likes/").concat(t),{method:"DELETE",headers:H.headers}).then(J)).then((function(){o.textContent=Number(o.textContent)-1,n.classList.remove("element__like-button_active")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(H.baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:H.headers}).then(J)}(e._id).then((function(){o.textContent=Number(o.textContent)+1,n.classList.add("element__like-button_active")})).catch((function(e){console.log(e)}))})),e.owner._id===G?c.addEventListener("click",(function(){var t;(t=e._id,fetch("".concat(H.baseUrl,"cards/").concat(t),{method:"DELETE",headers:H.headers}).then(J)).then((function(){c.closest(".element").remove()})).catch((function(e){console.log(e)}))})):c.classList.add("element__delete-button_hidden"),r.addEventListener("click",(function(){F(a.textContent,r.src)})),o.textContent=0===e.likes.length?0:e.likes.length,t}function M(e,t,n,o){var c=e.querySelector(".".concat(t.name,"-error"));t.classList.add("".concat(o.inputErrorClass)),c.textContent=n,c.classList.add("".concat(o.errorClass))}function $(e,t,n){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.remove("".concat(n.inputErrorClass)),o.textContent="",o.classList.remove("".concat(n.errorClass))}function I(e,t){Array.from(e.querySelectorAll("".concat(t.inputSelector))).forEach((function(n){$(e,n,t)}))}function F(e,t){L.textContent=e,L.alt=e,k.src=t,O(C)}function K(){fetch("".concat(H.baseUrl,"users/me"),{method:"GET",headers:H.headers}).then(J).then((function(e){f.textContent=e.name,m.textContent=e.about,g.src=e.avatar,G=e._id})).catch((function(e){console.log(e)}))}i.addEventListener("click",(function(){P(r)})),p.addEventListener("click",(function(){P(C)})),s.addEventListener("click",(function(){P(u)})),d.addEventListener("click",(function(){P(x)})),B.addEventListener("click",(function(){P(A)})),T.addEventListener("click",(function(e){var t,n;T.textContent="Сохранение...",t=N(U.value)||!U.value?U.value:D,(n=JSON.stringify({avatar:t}),fetch("".concat(H.baseUrl,"users/me/avatar"),{method:"PATCH",headers:H.headers,body:n}).then(J)).then((function(){K(),P(A)})).catch((function(e){console.log(e)})).finally((function(){T.textContent="Сохранить"}))})),w.addEventListener("click",(function(){O(A),U.value=""})),c.addEventListener("click",(function(){!function(e,t){var n=e.querySelector("".concat(t.submitButtonSelector));n.disabled=!0,n.classList.add("".concat(t.inactiveButtonClass))}(u,n),function(e,t){Array.from(e.querySelectorAll("".concat(t.inputSelector))).forEach((function(e){e.value=""}))}(u,n),I(u,n),O(u),document.addEventListener("keydown",j)})),o.addEventListener("click",(function(){I(r,n),function(e,t){var n=e.querySelector("".concat(t.submitButtonSelector));n.disabled=!1,n.classList.remove("".concat(t.inactiveButtonClass))}(r,n),v.value=f.textContent,h.value=m.textContent,O(r)})),_.addEventListener("submit",(function(e){var t;e.preventDefault(),a.textContent="Сохранение...",(t=JSON.stringify({name:v.value,about:h.value}),fetch("".concat(H.baseUrl,"users/me"),{method:"PATCH",headers:H.headers,body:t}).then(J)).then((function(){f.textContent=v.value,m.textContent=h.value,P(r)})).catch((function(e){console.log(e)})).finally((function(){a.textContent="Сохранить"}))})),y.addEventListener("submit",(function(e){var t;(e.preventDefault(),l.textContent="Сохранение...",q.value&&E.value)&&(q.value,E.value,(t=JSON.stringify({name:q.value,link:E.value}),fetch("".concat(H.baseUrl,"cards"),{method:"POST",headers:H.headers,body:t}).then(J)).then((function(t){b.prepend(z(t)),P(u),e.target.reset()})).catch((function(e){console.log(e)})).finally((function(){l.textContent="Сохранить"})))})),Array.from(document.querySelectorAll(".popup")).forEach((function(e){!function(e){e.addEventListener("click",(function(t){t.target.closest(".popup__container")||P(e)}))}(e)})),function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(n){!function(e,n){var o=Array.from(e.querySelectorAll("".concat(n.inputSelector))),c=e.querySelector("".concat(n.submitButtonSelector));o.forEach((function(r){r.addEventListener("input",(function(){!function(e,n,o){t.lastIndex=0,n.validity.valid?n.dataset.regex&&!t.test(n.value)?M(e,n,n.dataset.customError,o):$(e,n,o):M(e,n,n.validationMessage,o)}(e,r,n),function(e,t,n){!function(e,t){return e.some((function(e){return e.classList.contains("".concat(t.inputErrorClass))||""===e.value}))}(e,n)?(t.disabled=!1,t.classList.remove("".concat(n.inactiveButtonClass))):(t.disabled=!0,t.classList.add("".concat(n.inactiveButtonClass)))}(o,c,n)}))}))}(n,e)}))}(n),K(),fetch("".concat(H.baseUrl,"cards"),{method:"GET",headers:H.headers}).then(J).then((function(e){b.textContent="",e.forEach((function(e){return b.append(z(e))}))})).catch((function(e){console.log(e)}))})();